jQuery(function(p){"en"===wp_stream.locale&&void 0!==p.timeago&&(p.timeago.settings.strings.seconds="seconds",p.timeago.settings.strings.minute="a minute",p.timeago.settings.strings.hour="an hour",p.timeago.settings.strings.hours="%d hours",p.timeago.settings.strings.month="a month",p.timeago.settings.strings.year="a year"),p("li.toplevel_page_wp_stream ul li.wp-first-item.current").parent().parent().find(".update-plugins").remove(),p(".toplevel_page_wp_stream :input.chosen-select").each(function(e,t){function a(e){var t=p("<span>"),a=p(e.element),i="";return"- "===e.text.substring(0,2)&&(e.text=e.text.substring(2)),void 0!==e.id&&"string"==typeof e.id&&(0===e.id.indexOf("group-")?t.addClass("parent"):a.hasClass("level-2")&&t.addClass("child")),void 0!==e.icon?i=e.icon:void 0!==a&&""!==a.data("icon")&&(i=a.data("icon")),i&&t.html('<img src="'+i+'" class="wp-stream-select2-icon">'),t.append(e.text),t}function i(e){return"- "===e.text.substring(0,2)&&(e.text=e.text.substring(2)),e.text}var n={},n=0<p(t).find("option").not(":selected").not(":empty").length?{minimumResultsForSearch:10,templateResult:a,templateSelection:i,allowClear:!0,width:"165px"}:{minimumInputLength:3,allowClear:!0,width:"165px",ajax:{url:ajaxurl,delay:500,dataType:"json",quietMillis:100,data:function(e){return{action:"wp_stream_filters",nonce:p("#stream_filters_user_search_nonce").val(),filter:p(t).attr("name"),q:e.term}},processResults:function(e){var a=[];return p.each(e,function(e,t){a.push({id:t.id,text:t.label})}),{results:a}}},templateResult:a,templateSelection:i};p(t).select2(n)});var e=p.streamGetQueryVars(),t=p('.toplevel_page_wp_stream select.chosen-select[name="context"]'),i=(void 0!==e.context&&""!==e.context||void 0===e.connector||(t.val("group-"+e.connector),t.trigger("change")),p("input[type=submit]","#record-filter-form").click(function(){p("input[type=submit]",p(this).parents("form")).removeAttr("clicked"),p(this).attr("clicked","true")}),p("#record-filter-form").submit(function(){var e=p('.toplevel_page_wp_stream :input.chosen-select[name="context"]'),t=e.find("option:selected"),e=e.parent().find(".record-filter-connector"),a=t.data("group"),i=t.prop("class"),n=p(".recordactions select");"true"!==p("#record-actions-submit").attr("clicked")&&n.val(""),e.val(a),"level-1"===i&&t.val("")}),p(window).on("load",function(){p('.toplevel_page_wp_stream input[type="search"]').off("mousedown")}),p("body").on("click","#wp_stream_advanced_delete_all_records, #wp_stream_network_advanced_delete_all_records",function(e){window.confirm(wp_stream.i18n.confirm_purge)||e.preventDefault()}),p("body").on("click","#wp_stream_advanced_reset_site_settings, #wp_stream_network_advanced_reset_site_settings",function(e){window.confirm(wp_stream.i18n.confirm_defaults)||e.preventDefault()}),p(".wp_stream_screen .nav-tab-wrapper")),n=p(".wp_stream_screen .nav-tab-content table.form-table"),e=i.find(".nav-tab-active"),t=0<e.length?i.find("a").index(e):0,e=window.location.hash.match(/^#(\d+)$/),e=null!==e?e[1]:t,a=(i.on("click","a",function(){var e,t=i.find("a").index(p(this)),a=window.location.hash.match(/^#(\d+)$/);return n.hide().eq(t).show(),i.find("a").removeClass("nav-tab-active").filter(p(this)).addClass("nav-tab-active"),""!==window.location.hash&&null===a||(window.location.hash=t),a=t,0!==(t=p('input[name="option_page"][value^="wp_stream"]').closest("form")).length&&(e=t.attr("action"),t.prop("action",e.replace(/(^[^#]*).*$/,"$1#"+a))),!1}),i.children().eq(e).trigger("click"),p(document).ready(function(){function t(){var e=!0;p('div.metabox-prefs [name="date-hide"]').is(":checked")&&(e=!1),p("div.alignleft.actions div.select2-container").each(function(){if(!p(this).is(":hidden"))return e=!1}),e?(p("input#record-query-submit").hide(),p("span.filter_info").show()):(p("input#record-query-submit").show(),p("span.filter_info").hide())}p("#enable_live_update").click(function(){var e,t=p("#stream_live_update_nonce").val(),a=p("#enable_live_update_user").val(),i="unchecked";p("#enable_live_update").is(":checked")&&(i="checked"),e=p("#enable_live_update").data("heartbeat"),p.ajax({type:"POST",url:ajaxurl,data:{action:"stream_enable_live_update",nonce:t,user:a,checked:i,heartbeat:e},dataType:"json",beforeSend:function(){p(".stream-live-update-checkbox .spinner").show().css({display:"inline-block"})},success:function(e){p(".stream-live-update-checkbox .spinner").hide(),!1===e.success&&(p("#enable_live_update").prop("checked",!1),e.data&&window.alert(e.data))}})}),p('div.metabox-prefs [name="date-hide"]').is(":checked")?p("div.date-interval").show():p("div.date-interval").hide(),p("div.actions select.chosen-select").each(function(){var e=p(this).prop("name");p('div.metabox-prefs [name="'+e+'-hide"]').is(":checked")?p(this).prev(".select2-container").show():p(this).prev(".select2-container").hide()}),t(),p('div.metabox-prefs [type="checkbox"]').click(function(){var e=p(this).prop("id");"date-hide"===e?p(this).is(":checked")?p("div.date-interval").show():p("div.date-interval").hide():(e=e.replace("-hide",""),p(this).is(":checked")?p('[name="'+e+'"]').prev(".select2-container").show():p('[name="'+e+'"]').prev(".select2-container").hide()),t()}),p("#ui-datepicker-div").addClass("stream-datepicker")}),p("table.wp-list-table").on("updated",function(){p(this).find("time.relative-time").each(function(e,t){t=p(t);t.removeClass("relative-time"),p('<strong><time datetime="'+t.attr("datetime")+'" class="timeago"/></time></strong><br/>').prependTo(t.parent().parent()).find("time.timeago").timeago()})}).trigger("updated"),{init:function(e){this.wrapper=e,this.save_interval(this.wrapper.find(".button-primary"),this.wrapper),this.$=this.wrapper.each(function(e,t){var a,i,t=p(t),n=t.find(".date-inputs"),r=t.find(".field-from"),s=t.find(".field-to"),o=s.prev(".date-remove"),c=r.prev(".date-remove"),d=t.children(".field-predefined"),l=p("").add(s).add(r);jQuery.datepicker&&(t=parseFloat(wp_stream.gmt_offset)-(new Date).getTimezoneOffset()/60*-1,a=new Date,t=new Date(a.getTime()+60*t*60*1e3),i=0,a.getDate()===t.getDate()&&a.getMonth()===t.getMonth()||(i=a.getTime()<t.getTime()?"+1d":"-1d"),l.datepicker({dateFormat:"yy/mm/dd",minDate:null,maxDate:i,defaultDate:t,beforeShow:function(){p(this).prop("disabled",!0)},onClose:function(){p(this).prop("disabled",!1)}}),l.datepicker("widget").addClass("stream-datepicker")),d.select2({allowClear:!0}),""!==r.val()&&c.show(),""!==s.val()&&o.show(),d.on({change:function(){var e=p(this).val(),t=d.find('[value="'+e+'"]'),a=t.data("to"),t=t.data("from");if("custom"===e)return n.show(),!1;n.hide(),l.datepicker("hide"),r.val(t).trigger("change",[!0]),s.val(a).trigger("change",[!0]),jQuery.datepicker&&l.datepicker("widget").is(":visible")&&l.datepicker("refresh").datepicker("hide")},"select2-removed":function(){d.val("").trigger("change")},check_options:function(){var e;(""!==s.val()&&""!==r.val()?0!==(e=d.find("option").filter('[data-to="'+s.val()+'"]').filter('[data-from="'+r.val()+'"]')).length?d.val(e.attr("value")):d.val("custom"):""===s.val()&&""===r.val()?d.val(""):d.val("custom")).trigger("change",[!0])}}),r.on("change",function(){if(""!==r.val()?(c.show(),s.datepicker("option","minDate",r.val())):c.hide(),!0===arguments[arguments.length-1])return!1;d.trigger("check_options")}),s.on("change",function(){if(""!==s.val()?(o.show(),r.datepicker("option","maxDate",s.val())):o.hide(),!0===arguments[arguments.length-1])return!1;d.trigger("check_options")}),d.trigger("change"),p("").add(c).add(o).on("click",function(){p(this).next("input").val("").trigger("change")})})},save_interval:function(e){var t=this.wrapper;e.click(function(){var e={key:t.find("select.field-predefined").find(":selected").val(),start:t.find(".date-inputs .field-from").val(),end:t.find(".date-inputs .field-to").val()};p(this).attr("href",p(this).attr("href")+"&"+p.param(e))})}});p(document).ready(function(){a.init(p(".date-interval")),p('select[name="context"] .level-1').each(function(){var e=!0;p(this).nextUntil(".level-1").each(function(){if(p(this).is(":not(:disabled)"))return e=!1}),!0===e&&p(this).prop("disabled",!0)})})}),jQuery.extend({streamGetQueryVars:function(e){return(e||document.location.search).replace(/(^\?)/,"").split("&").map(function(e){return this[(e=e.split("="))[0]]=e[1],this}.bind({}))[0]}});