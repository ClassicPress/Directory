jQuery(function(s){"use strict";function l(t){(t=s(t)).find(".select2-select.connector_or_context").each(function(t,e){s(e).select2({allowClear:!0,placeholder:streamAlerts.anyContext,templateResult:function(t){return void 0===t.id?t.text:-1===t.id.indexOf("-")?s('<span class="parent">'+t.text+"</span>"):s('<span class="child">'+t.text+"</span>")},matcher:function(t,e){var n=s.extend(!0,{},e);if(null===t.term||""===s.trim(t.term))return n;var a=t.term.toLowerCase();if(n.id=n.id.replace("blogs","sites"),0<=n.id.toLowerCase().indexOf(a))return n;if(n.children){for(var i=n.children.length-1;0<=i;i--)-1===n.children[i].id.toLowerCase().indexOf(a)&&n.children.splice(i,1);if(0<n.children.length)return n}return null}}).change(function(){var t=s(this).val();t&&(t=t.split("-"),s(this).siblings(".connector").val(t[0]),s(this).siblings(".context").val(t[1]))});var n=[s(e).siblings(".connector").val(),s(e).siblings(".context").val()];""===n[1]&&n.splice(1,1),s(e).val(n.join("-")).trigger("change")}),t.find("select.select2-select:not(.connector_or_context)").each(function(){var t=s(this).attr("id").split("_"),t=t[t.length-1].charAt(0).toUpperCase()+t[t.length-1].slice(1);s(this).select2({allowClear:!0,placeholder:streamAlerts.any+" "+t})})}function i(t){var t={action:"load_alerts_settings",alert_type:t},e=s("#wp_stream_alert_type").closest("tr").attr("id");t.post_id=e.split("-")[1],s.post(window.ajaxurl,t,function(t){var e=s("#wp_stream_alert_type_form");"none"===s("#wp_stream_alert_type").val()?e.hide():(e.html(t.data.html),e.show())})}var o,c,t,e=s("#wp_stream_alert_type"),n=(s("#the-list").on("change","#wp_stream_trigger_connector_or_context",function(){var t;"wp_stream_trigger_connector_or_context"===s(this).attr("id")&&((t=s(this).val())&&0<t.indexOf("-")&&(t=t.split("-")[0]),n(t))}),function(t){var r=s("#wp_stream_trigger_action"),e=(r.empty(),r.prop("disabled",!0),s("<option/>",{value:"",text:""}));r.append(e),s.post(window.ajaxurl,{action:"get_actions",connector:t},function(t){var e,n=t.success,a=t.data;if(n){for(var i in a)a.hasOwnProperty(i)&&(e=a[i],i=s("<option/>",{value:i,text:e}),r.append(i));r.prop("disabled",!1),s(document).trigger("alert-actions-updated")}})}),r=(e.change(function(){i(s(this).val())}),s("#wpbody-content").on("click","a.page-title-action",function(t){t.preventDefault(),s("#add-new-alert").remove(),0<s(".inline-edit-wp_stream_alerts").length&&s(".inline-edit-wp_stream_alerts .inline-edit-save button.button-secondary.cancel").trigger("click");var a;s.post(window.ajaxurl,{action:"get_new_alert_triggers_notifications"},function(t){var e,n;!0===t.success&&(a=t.data.html,s("tbody#the-list").prepend('<tr id="add-new-alert" class="inline-edit-row inline-edit-row-page inline-edit-page quick-edit-row quick-edit-row-page inline-edit-page inline-editor" style=""><td colspan="4" class="colspanchange">'+a+'<p class="submit inline-edit-save"> <button type="button" class="button-secondary cancel alignleft">Cancel</button> <input type="hidden" id="_inline_edit" name="_inline_edit" value="3550d271fe"> <button type="button" class="button-primary save alignright">Save</button> <span class="spinner"></span><span class="error" style="display:none"></span> <br class="clear"></p></td></tr>'),e=s("#add-new-alert"),n=e.css("background-color"),e.css("background-color","#C1E1B9"),setTimeout(function(){e.css("background-color",n)},250),s("#wp_stream_alert_type").change(function(){i(s(this).val())}),e.on("click",".button-secondary.cancel",function(){s("#add-new-alert").remove()}),e.on("click",".button-primary.save",r),l("#add-new-alert"))})}),function(t){t.preventDefault(),s("#add-new-alert").find("p.submit.inline-edit-save span.spinner").css("visibility","visible");var e={action:"save_new_alert",wp_stream_alerts_nonce:s("#wp_stream_alerts_nonce").val(),wp_stream_trigger_author:s("#wp_stream_trigger_author").val(),wp_stream_trigger_context:s("#wp_stream_trigger_connector_or_context").val(),wp_stream_trigger_action:s("#wp_stream_trigger_action").val(),wp_stream_alert_type:s("#wp_stream_alert_type").val(),wp_stream_alert_status:s("#wp_stream_alert_status").val()};s("#wp_stream_alert_type_form").find(":input").each(function(){var t=s(this).attr("id");s(this).val()&&(e[t]=s(this).val())}),s.post(window.ajaxurl,e,function(t){!0===t.success&&(s("#add-new-alert").find("p.submit.inline-edit-save span.spinner").css("visibility","hidden"),location.reload())})}),p=inlineEditPost.edit;inlineEditPost.edit=function(t){p.apply(this,arguments);var e,n,a,i,r=0;0<(r="object"==typeof t?parseInt(this.getId(t),10):r)&&(c=s("#edit-"+r),n=(t=(o=s("#post-"+r)).find('input[name="wp_stream_trigger_connector"]').val())+"-"+(e=o.find('input[name="wp_stream_trigger_context"]').val()),a=o.find('input[name="wp_stream_trigger_action"]').val(),i=o.find('input[name="wp_stream_alert_status"]').val(),c.find('input[name="wp_stream_trigger_connector"]').attr("value",t),c.find('input[name="wp_stream_trigger_context"]').attr("value",e),c.find('select[name="wp_stream_trigger_connector_or_context"] option[value="'+n+'"]').attr("selected","selected"),s(document).one("alert-actions-updated",function(){c.find('input[name="wp_stream_trigger_action"]').attr("value",a),c.find('select[name="wp_stream_trigger_action"] option[value="'+a+'"]').attr("selected","selected").trigger("change")}),c.find('select[name="wp_stream_alert_status"] option[value="'+i+'"]').attr("selected","selected"),l("#edit-"+r),s("#wp_stream_alert_type_form").hide(),t=o.find('input[name="wp_stream_alert_type"]').val(),c.find('select[name="wp_stream_alert_type"] option[value="'+t+'"]').attr("selected","selected").trigger("change"))},window.location.hash&&(e=s(window.location.hash)).length&&(t=e.offset().top-s("#wpadminbar").height(),s("html, body").animate({scrollTop:t},1e3),e.find(".row-actions a.editinline").trigger("click"))});